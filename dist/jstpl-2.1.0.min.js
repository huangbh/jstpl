/**
 * JSTPL, 极速javascript template engine version 2.1.0
 * https://github.com/huangbh/jstpl
 * 完全免费,随便使用,神马BSD协议是随便选的,
 * 只是希望大家尽量保留前面的注释,你懂的...
 * 其实只是便于你更新,哈哈
 * 
 * 从2.0起,JSTPL是支持DOM和function两种形式的~yeah~!
 * 用法:
 *   function 形式
 *   $tpl(tplfunc)(...) 
 *   DOM 形式:
 *   $tpl(args, body)(...)
 *   $tpl(domid)(...)
 * 
 * 版本2.1
 * 升级为nodejs可以使用的modules 
 * 并提供内部函数和共享空间
 *
 * @author huang benhua (黄本华) 
 * @email 24860657@qq.com
*/
!function(g){var m={$template:function(a,b){return a}};g=g(m);var o=g.use_token_array||0;var q={'\"':'\\"',"\'":"\\'",'\r':'\\r','\n':'\\n','\\':'\\\\'};var r=/[\\\\\"\'\r\n]|[^\\\\\"\'\r\n]+/g;var t=o?function(s){var a=s.match(r),l=a.length,i=0,p,rps=q;while(i<l){if(a[i].length==1){p=rps[a[i]];if(p)a[i]=p}++i};return a.join('')}:function(s){var a=s.match(r),l=a.length,i=0,p,rps=q,h='';while(i<l){p=a[i++];if(p.length>1)h+=p;else h+=rps[p]||p};return h};var u=o?function(a,i,l,h){if(!l)return h;h=h?[h]:[];while(i<l)h.push(a[i++]);return h.join('')}:function(a,i,l,h){if(!l)return h;h=h||'';while(i<l)h+=a[i++];return h};function _comb(){return u(arguments,0,arguments.length)};function _sp2(s,p,f,x,b,a){var i,n=0,fc,jb;while(s.length){i=s.indexOf(p[b]);if(i<0)i=s.length;if(i){if(b){fc=s.charAt(0);jb=(fc==x)?1:0;f(s.substring(jb,i),1,n++,jb?0:fc,a)}else{f(s.substr(0,i),0,n++,0,a)}};s=s.substr(i+p[b].length);b=1-b};return n};var y=(o?'var H=[]':'var H=""')+',S=arguments,T=S.callee,$tpl=T._$tpl,J=T._$env,C=this'+',N="\\n",A="{",B="}",R="\\r",_=$tpl._comb,X="*",P="%";';function _analy(s,d,e,b,f){_sp2(s,d,function(s,b,n,a,c,i,j){if(a){if(a=='\\'){i=s.indexOf('\\',1)+1;if(i>3)j=s.substr(1,i-2);c(s.substr(i||1),i,j)}else if(a=='/'){c(s.substr(1),0,0,1)}else{c(s)}}else if(b){c(s.substr(1),0,0,0,1)}else{c(s,1,0,0,1)}},e,b,f)};var z;if(o){z=function(s,e,f,b){s=m.$template(s,b);var c=[y];if(m.$tpl_prefix){c.push(m.$tpl_prefix)};_analy(s,e,f,b,function(x,i,j,w,d){function _build_ie(s,b,n,a){if(n){c.push(',')}else{if(i){if(j)c.push(j);c.push('[')}else if(!w){c.push('H.push(')}};if(a){c.push(s)}else{c.push('"',t(s),'"')}};if(d){if(i)return c.push(x);_build_ie(x,0,0,j)};if(d||_sp2(x,['{','}'],_build_ie,'\\',0)){if(i)c.push('].join("")\n');else if(!w)c.push(');')}});c.push(';return H.join("");');return c.join('')}}else{z=function(s,e,f,b){s=m.$template(s,b);var c=y;if(m.$tpl_prefix){c+=m.$tpl_prefix};_analy(s,e,f,b,function(x,i,j,w,d){function _build(s,b,n,a){if(i){if(n){c+=','}else{if(j)c+=j;c+='$tpl._combx(['}}else{if(!w)c+='H+=';else if(n)c+=','};if(a){c+=s}else{c+='"';c+=t(s);c+='"'};if(!i&&!w)c+=';'};if(d){if(i)c+=x;else _build(x,0,0,j);return};w=_sp2(x,['{','}'],_build,'\\',0);if(i&&w){c+='],0,';c+=w;c+=')\n'}});c+=";return H;";return c}};function _none(){return""};_none._$tpl=1;function _create_jstpl_txt(a,b,c,d){var f=c(a,z(b,['%>','<%'],'%',1));f._$tpl=d;f._$env=m;return f};function _create_jstpl_func(f,b,c,n){n=f;var s=f.toString(),i=s.indexOf('{'),a=s.substr(0,i);s=z(s.substr(i+1,s.length-i-2),['/*','*/'],'*',0);i=a.indexOf('(');f=b(a.substring(i+1,a.indexOf(')',i)),s);f._$tpl=c;f._$env=m;n._jstpl=f;return f};function _create_jstpl_dom(a,b,c,d,n){n=b;a=n.getAttribute(a||'jstpl')||'data';b=n.innerHTML;if(o)b=b.replace(/^[\r\n]+/,'');var f=_create_jstpl_txt(a,b,c,d);n._jstpl=f;return f};function _create_jstpl(b,d){function _jstpl(a,c){if(!a||a.charAt){if(c&&c.charAt){return _create_jstpl_txt(a||'data',c,b,_jstpl)};if(d){if(!c)c=d(a);if(c){if(c._jstpl)return c._jstpl;return _create_jstpl_dom(0,c,b,_jstpl)}};if(!a)return _none;if(!c)return _create_jstpl_txt('data',a,b,_jstpl);return _none};if(a._$tpl)return a;if(a._jstpl&&!c)return a._jstpl;if(d&&a.getTagName){return _create_jstpl_dom(c,a,b,_jstpl)};return _create_jstpl_func(a,b,_jstpl)};_jstpl._comb=_comb;_jstpl._combx=u;_jstpl.J=_jstpl.set=function(k,v){switch(arguments.length){case 0:break;case 1:{for(var p in k){m[p]=k[p]}};break;default:m[k]=v};return m};return _jstpl};g(_create_jstpl)}(function(h){function func_creator(a,b){if(h.use_with){b='with(arguments[0]){'+b+'}'};var f=new Function(a,b);f.render=function(){return f.apply(this||f,arguments)};return f};try{if(window){function initializer(d){function _init(a,b){var c=d(func_creator,function(n){return n?a.document.getElementById(n):0});c._init=_init;a.$tpl=c};_init(window,func_creator)};initializer.use_token_array=(!-[1,]);return initializer}}catch(ex){console.log('JSTPL initializing in Node.js...')};return function(d){var e=d(func_creator);var f=require('fs');var g={};h.use_with=1;h.suffix='.htm';h.$tpl_prefix="function $include(_p,_d){return $tpl.view(_p).apply(C,_d?_d:S);};";e.view=function(a,b){var v=g[a];if(!v||b){v=f.readFileSync((h.root||'')+'/'+a+(h.suffix||'.htm'));v=v?v.toString():0;v=e(h.args||'data',v);if(!h.debug){g[a]=v}};return v};e.render=function(){var c=arguments;return function(){var b='',a=arguments;if(h.header){b+=e.view(h.header).apply(this,a)};for(var i=0;i<c.length;i++){b+=e.view(c[i]).apply(this,a)};if(h.footer){b+=e.view(h.footer).apply(this,a)};return b}};e.compile=function(a,b,c){if(b){var v=e(b,c);g[a]=v;return v};return e(h.args||'data',a)};module.exports=e;console.log('JSTPL initialized in Node.js.');return}});