/**
 * JSTPL, 极速javascript template engine version 2.1.0
 * https://github.com/huangbh/jstpl
 * 完全免费,随便使用,神马BSD协议是随便选的,
 * 只是希望大家尽量保留前面的注释,你懂的...
 * 其实只是便于你更新,哈哈
 * 
 * 从2.0起,JSTPL是支持DOM和function两种形式的~yeah~!
 * 用法:
 *   function 形式
 *   $tpl(tplfunc)(...) 
 *   DOM 形式:
 *   $tpl(args, body)(...)
 *   $tpl(domid)(...)
 * 
 * 版本2.1
 * 升级为nodejs可以使用的modules 
 * 并提供内部函数和共享空间
 *
 * @author huang benhua (黄本华) 
 * @email 24860657@qq.com
*/
!function(e){var c={$template:function(r,s){return r}};e=e(c);var d=e._uta||0;var g={'"':'\\"',"'":"\\'","\r":"\\r","\n":"\\n","\\":"\\\\"};var p=/[\\\\\"\'\r\n]|[^\\\\\"\'\r\n]+/g;var l=d?function(w){var t=w.match(p),r=t.length,v=0,x,u=g;while(v<r){if(t[v].length==1){x=u[t[v]];if(x){t[v]=x}}++v}return t.join("")}:function(x){var t=x.match(p),r=t.length,v=0,y,u=g,w="";while(v<r){y=t[v++];if(y.length>1){w+=y}else{w+=u[y]||y}}return w};var q=d?function(s,t,r,u){if(!r){return u}u=u?[u]:[];while(t<r){u.push(s[t++])}return u.join("")}:function(s,t,r,u){if(!r){return u}u=u||"";while(t<r){u+=s[t++]}return u};function n(){return q(arguments,0,arguments.length)}function a(C,r,w,A,z,y){var v,u=0,t,B;while(C.length){v=C.indexOf(r[z]);if(v<0){v=C.length}if(v){if(z){t=C.charAt(0);B=(t==A)?1:0;w(C.substring(B,v),1,u++,B?0:t,y)}else{w(C.substr(0,v),0,u++,0,y)}}C=C.substr(v+r[z].length);z=1-z}return u}var o=(d?"var H=[]":'var H=""')+',S=arguments,T=S.callee,$tpl=T._$tpl,J=T._$env,C=this,N="\\n",A="{",B="}",R="\\r",_=$tpl._comb,X="*",P="%";';function f(u,w,v,t,r){a(u,w,function(C,y,D,B,x,A,z){if(B){if(B=="\\"){A=C.indexOf("\\",1)+1;if(A>3){z=C.substr(1,A-2)}x(C.substr(A||1),A,z)}else{if(B=="/"){x(C.substr(1),0,0,1)}else{x(C)}}}else{if(y){x(C.substr(1),0,0,0,1)}else{x(C,1,0,0,1)}}},v,t,r)}var m;if(d){m=function(t,w,u,r){t=c.$template(t,r);var v=[o];if(c.$tpl_prefix){v.push(c.$tpl_prefix)}if(c.use_with){v.push("with(S[0]){")}f(t,w,u,r,function(s,B,z,y,C){function A(E,x,F,D){if(F){v.push(",")}else{if(B){if(z){v.push(z)}v.push("[")}else{if(!y){v.push("H.push(")}}}if(D){v.push(E)}else{v.push('"',l(E),'"')}}if(C){if(B){return v.push(s)}A(s,0,0,z)}if(C||a(s,["{","}"],A,"\\",0)){if(B){v.push('].join("")\n')}else{if(!y){v.push(");")}}}});v.push(';return H.join("");');if(c.use_with){v.push("}")}return v.join("")}}else{m=function(t,w,u,r){t=c.$template(t,r);var v=o;if(c.$tpl_prefix){v+=c.$tpl_prefix}if(c.use_with){v+="with(S[0]){"}f(t,w,u,r,function(s,B,z,y,C){function A(E,x,F,D){if(B){if(F){v+=","}else{if(z){v+=z}v+="$tpl._combx(["}}else{if(!y){v+="H+="}else{if(F){v+=","}}}if(D){v+=E}else{v+='"';v+=l(E);v+='"'}if(!B&&!y){v+=";"}}if(C){if(B){v+=s}else{A(s,0,0,z)}return}y=a(s,["{","}"],A,"\\",0);if(B&&y){v+="],0,";v+=y;v+=")\n"}});v+=";return H;";if(c.use_with){v+="}"}return v}}function h(){return""}h._$tpl=1;function k(t,r,v,s){var u=v(t,m(r,["%>","<%"],"%",1));u._$tpl=s;u._$env=c;return u}function b(w,x,t,y){y=w;var v=w.toString(),u=v.indexOf("{"),r=v.substr(0,u);v=m(v.substr(u+1,v.length-u-2),["/*","*/"],"*",0);u=r.indexOf("(");w=x(r.substring(u+1,r.indexOf(")",u)),v);w._$tpl=t;w._$env=c;y._jstpl=w;return w}function j(s,v,u,r,w){w=v;s=w.getAttribute(s||"jstpl")||"data";v=w.innerHTML;if(d){v=v.replace(/^[\r\n]+/,"")}var t=k(s,v,u,r);w._jstpl=t;return t}function i(t,s){function r(u,v){if(!u||u.charAt){if(v&&v.charAt){return k(u||"data",v,t,r)}if(s){if(!v){v=s(u)}if(v){if(v._jstpl){return v._jstpl}return j(0,v,t,r)}}if(!u){return h}if(!v){return k("data",u,t,r)}return h}if(u._$tpl){return u}if(u._jstpl&&!v){return u._jstpl}if(s&&u.getTagName){return j(v,u,t,r)}return b(u,t,r)}r._comb=n;r._combx=q;r.J=r.set=function(w,u){switch(arguments.length){case 0:break;case 1:for(var x in w){c[x]=w[x]}break;default:c[w]=u}return c};return r}e(i)}(function(c){function d(g,e){var h=new Function(g,e);h.render=function(){return h.apply(this||h,arguments)};return h}try{if(window){function b(e){function f(i,g){var h=e(d,function(j){return j?i.document.getElementById(j):0});h._init=f;i.$tpl=h}f(window,d)}b._uta=(!-[1]);return b}}catch(a){console.log("JSTPL initializing in Node.js...")}return function(g){var h=g(d);var e=require("fs");var f={};c.use_with=1;c.suffix=".htm";c.$tpl_prefix="function $include(_p,_d){return $tpl.view(_p).apply(C,_d?_d:S);};";h.view=function(k,j){var i=f[k];if(!i||j){i=e.readFileSync((c.root||"")+"/"+k+(c.suffix||".htm"));i=i?i.toString():0;i=h(c.args||"data",i);if(!c.debug){f[k]=i}}return i};h.render=function(){var i=arguments;return function(){var k="",j=arguments;if(c.header){k+=h.view(c.header).apply(this,j)}for(var l=0;l<i.length;l++){k+=h.view(i[l]).apply(this,j)}if(c.footer){k+=h.view(c.footer).apply(this,j)}return k}};h.compile=function(i,k,l){if(k){var j=h(k,l);f[i]=j;return j}return h(c.args||"data",i)};module.exports=h;console.log("JSTPL initialized in Node.js.");return}});
